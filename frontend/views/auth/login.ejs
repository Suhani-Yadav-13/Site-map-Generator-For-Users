<% layout('layouts/main') %>

<div class="login-page-background">
  <div class="login-form-container">
    <h2>Login</h2>

    <% if (errorMessage && errorMessage.length > 0) { %>
      <div class="alert alert-danger alert-dismissible fade show">
        <%= errorMessage[0] %>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      </div>
    <% } %>
    <% if (successMessage && successMessage.length > 0) { %>
      <div class="alert alert-success alert-dismissible fade show">
        <%= successMessage[0] %>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      </div>
    <% } %>

    <form id="loginForm" method="post" action="/login" autocomplete="off" novalidate>
      <div class="mb-3 text-start">
        <label>Email</label>
        <input type="email" name="email" id="loginEmail" class="form-control" 
          placeholder="Enter Your Email" value="<%= oldInput.email || '' %>" required/>
        <div id="loginEmailError" class="text-white small mt-1 p-1 rounded d-none" style="background-color:black;"></div>
      </div>

      <div class="mb-3 text-start position-relative">
        <label>Password</label>
        <input type="password" name="password" id="loginPassword" class="form-control" placeholder="Enter Password" required/>
        <img src="/images/HIDE.png" id="toggleLoginPassword" alt="Toggle Password" style="position:absolute; right:10px; top:38px; width:20px; cursor:pointer;">
        <div id="loginPasswordError" class="text-white small mt-1 p-1 rounded d-none" style="background-color:black;"></div>
      </div>

      <button class="btn btn-primary w-100" type="submit">Login</button>
    </form>

    <p class="mt-3">Not registered? <a href="/signup">Sign up</a></p>
  </div>
</div>

<script>
const loginPassword = document.getElementById('loginPassword');
const toggleLogin = document.getElementById('toggleLoginPassword');

toggleLogin.addEventListener('click', () => {
  loginPassword.type = loginPassword.type === 'password' ? 'text' : 'password';
  toggleLogin.src = loginPassword.type === 'password' ? '/images/HIDE.png' : '/images/SHOW.jpg';
});

document.getElementById("loginForm").addEventListener("submit", function(e){
  let valid = true;
  const email = document.getElementById("loginEmail").value.trim();
  const password = document.getElementById("loginPassword").value.trim();
  const emailError = document.getElementById("loginEmailError");
  const passwordError = document.getElementById("loginPasswordError");
  const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

  if(!emailPattern.test(email)){
    emailError.textContent = "Enter a valid email";
    emailError.classList.remove("d-none");
    valid = false;
  } else emailError.classList.add("d-none");

  if(password === ""){
    passwordError.textContent = "Enter your password";
    passwordError.classList.remove("d-none");
    valid = false;
  } else passwordError.classList.add("d-none");

  if(!valid) e.preventDefault();
});
</script>
