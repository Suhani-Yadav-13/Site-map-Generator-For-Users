<% layout('layouts/main') %>

<div class="login-page-background">
  <div class="login-form-container">
    <h2 class="mb-4 text-center">Sign Up</h2>

    <% if (errorMessage && errorMessage.length > 0) { %>
      <div class="alert alert-danger alert-dismissible fade show"><%= errorMessage[0] %></div>
    <% } %>
    <% if (successMessage && successMessage.length > 0) { %>
      <div class="alert alert-success alert-dismissible fade show"><%= successMessage[0] %></div>
    <% } %>

    <form method="post" action="/signup" autocomplete="off" novalidate>
      <div class="mb-3 text-start">
        <label>Name <span class="text-danger">*</span></label>
        <input type="text" name="name" id="signupName" class="form-control" placeholder="Enter Your Name" value="<%= oldInput.name || '' %>" required/>
        <div id="signupNameError" class="invalid-feedback"></div>
      </div>

      <div class="mb-3 text-start">
        <label>Email <span class="text-danger">*</span></label>
        <input type="email" name="email" id="signupEmail" class="form-control" placeholder="Enter Your Email" value="<%= oldInput.email || '' %>" required/>
        <div id="signupEmailError" class="invalid-feedback"></div>
      </div>

      <div class="mb-3 text-start position-relative">
        <label>Password <span class="text-danger">*</span></label>
        <input type="password" name="password" id="signupPassword" class="form-control" placeholder="Enter Password" autocomplete="new-password" required/>
        <img src="/images/HIDE.png" id="toggleSignupPassword" alt="Toggle Password" style="position:absolute; right:10px; top:38px; width:20px; cursor:pointer;">
        <div id="signupPasswordError" class="invalid-feedback"></div>
      </div>

      <button class="btn btn-primary w-100" type="submit">Sign Up</button>
    </form>

    <p class="mt-3 text-center">Already have an account? <a href="/login">Login</a></p>
  </div>
</div>

<script>
const signupPassword = document.getElementById("signupPassword");
const toggleSignup = document.getElementById("toggleSignupPassword");

toggleSignup.addEventListener("click", () => {
  signupPassword.type = signupPassword.type === "password" ? "text" : "password";
  toggleSignup.src = signupPassword.type === "password" ? "/images/HIDE.png" : "/images/SHOW.jpg";
});

document.querySelector("form").addEventListener("submit", function(e){
  let valid = true;

  const nameInput = document.getElementById("signupName");
  const emailInput = document.getElementById("signupEmail");
  const passwordInput = document.getElementById("signupPassword");

  const nameError = document.getElementById("signupNameError");
  const emailError = document.getElementById("signupEmailError");
  const passwordError = document.getElementById("signupPasswordError");

  const namePattern = /^[A-Za-z\s]{2,50}$/;
  const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  const passwordPattern = /^(?=.*[!@#$%^&*]).{6,}$/;

  if(!namePattern.test(nameInput.value.trim())){
    nameInput.classList.add("is-invalid");
    nameError.textContent = "Enter a valid name";
    valid = false;
  } else { nameInput.classList.remove("is-invalid"); nameError.textContent=""; }

  if(!emailPattern.test(emailInput.value.trim())){
    emailInput.classList.add("is-invalid");
    emailError.textContent = "Enter a valid email";
    valid = false;
  } else { emailInput.classList.remove("is-invalid"); emailError.textContent=""; }

  if(!passwordPattern.test(passwordInput.value.trim())){
    passwordInput.classList.add("is-invalid");
    passwordError.textContent = "Password must be at least 6 chars with a symbol";
    valid = false;
  } else { passwordInput.classList.remove("is-invalid"); passwordError.textContent=""; }

  if(!valid) e.preventDefault();
});
</script>
